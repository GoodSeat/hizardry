module CuiRender where

import Control.Monad

import Characters
import Cui
import World
import GameAuto
import Maze


render :: Craphic -> IO ()
render = draw (70, 36)

txts :: Craphic -> [String]
txts c = do
  l <- [1..36]
  return $ concat [show $ at c (col, l) | col <- [1..70]]

msgBox :: String -> Craphic
msgBox m = foldl1 (<>) $ fmap toText (zip [1..] ls) ++
    [rect (5, 5) (62, length ls + 2) (Draw ' ')]
  where
    ls = lines m
    toText (n, t) = text (6, 5 + n) t

status :: [Character] -> Craphic
status p = foldl1 (<>) $ fmap toStatusLine (zip [1..] p) ++
    [text (4, 29) "#--CHARACTER NAME---------------CLASS-----AC----HITS---STATUS"
    ,rect (3, 29) (68, 8) (Draw ' ')]
  where
    toStatusLine (n, c) =  text (4,  29 + n) (show n ++ "  " ++ name c)
                        <> text (35, 29 + n) " G-Sam"
                        <> text (46, 29 + n) (show ac)
                        <> text (54, 29 + n) (show $ hp c)
                        <> text (61, 29 + n) (show $ maxhp c)
    ac = -7
    

scene :: Place -> Scenario -> Craphic
scene (InMaze p) scenario = foldl1 mappend $ front <$> [(d, s) | d <-[0..1], s <- [(-1)..1]]
  where
    m = mazes scenario !! z p
    front (d, s) = sw <> fw
      where
        fw = case visiblityAt m p d s F of
                 Wall -> frontWall d s
                 Door -> frontWall d s
                 _    -> mempty
        sw = let side = if s > 0 then R else L in
             case visiblityAt m p d s side of
                 Wall -> sideWall d s
                 Door -> sideWall d s
                 _    -> mempty
scene _ _ = mempty


-- ========================================================================
-- Position index:
--
--   <> Front wall     <> Side wall
--                    
-- depth             depth            
--    2  -- -- --         -- -- --
--         |  |        2 |  |  |  |
--    1  -- -- --         -- -- --
--         |  |        1 |  |  |  |
--    0  -- -- --         -- -- --
--         |@ |        0 |  |@ |  |
--                           
-- side  -1  0 +1       -2 -1 +1 +2
--
--
frontWall :: Int    -- ^ distance of depth.
          -> Int    -- ^ distance of side.
          -> Craphic
frontWall 0 0 = fromTexts '*'
  ["**********************************************************************"  --  1
  ,"**********************************************************************"  --  2
  ,"**********************************************************************"  --  3
  ,"*************_____________________________________________************"  --  4
  ,"*************|                                           |************"  --  5
  ,"*************|                                           |************"  --  6
  ,"*************|                                           |************"  --  7
  ,"*************|                                           |************"  --  8
  ,"*************|                                           |************"  --  9
  ,"*************|                                           |************"  --  10
  ,"*************|                                           |************"  --  11
  ,"*************|                                           |************"  --  12
  ,"*************|                                           |************"  --  13
  ,"*************|                                           |************"  --  14
  ,"*************|                                           |************"  --  15
  ,"*************|                                           |************"  --  16
  ,"*************|                                           |************"  --  17
  ,"*************|                                           |************"  --  18
  ,"*************|                                           |************"  --  19
  ,"*************|                                           |************"  --  20
  ,"*************|                                           |************"  --  21
  ,"*************|                                           |************"  --  22
  ,"*************|                                           |************"  --  23
  ,"*************|                                           |************"  --  24
  ,"*************|                                           |************"  --  25
  ,"*************|                                           |************"  --  26
  ,"*************|                                           |************"  --  27
  ,"*************|                                           |************"  --  28
  ,"*************|                                           |************"  --  29
  ,"*************|                                           |************"  --  30
  ,"*************|                                           |************"  --  31
  ,"*************|                                           |************"  --  32
  ,"*************|                                           |************"  --  33
  ,"*************|___________________________________________|************"  --  34
  ,"**********************************************************************"  --  35
  ,"**********************************************************************"] --  36
frontWall 0  1   = reverseH 36 $ frontWall 0 (-1)
frontWall 0 (-1) = fromTexts '*'
  ["**********************************************************************"  --  1
  ,"**********************************************************************"  --  2
  ,"**********************************************************************"  --  3
  ,"______________********************************************************"  --  4
  ,"             |********************************************************"  --  5
  ,"             |********************************************************"  --  6
  ,"             |********************************************************"  --  7
  ,"             |********************************************************"  --  8
  ,"             |********************************************************"  --  9
  ,"             |********************************************************"  --  10
  ,"             |********************************************************"  --  11
  ,"             |********************************************************"  --  12
  ,"             |********************************************************"  --  13
  ,"             |********************************************************"  --  14
  ,"             |********************************************************"  --  15
  ,"             |********************************************************"  --  16
  ,"             |********************************************************"  --  17
  ,"             |********************************************************"  --  18
  ,"             |********************************************************"  --  19
  ,"             |********************************************************"  --  20
  ,"             |********************************************************"  --  21
  ,"             |********************************************************"  --  22
  ,"             |********************************************************"  --  23
  ,"             |********************************************************"  --  24
  ,"             |********************************************************"  --  25
  ,"             |********************************************************"  --  26
  ,"             |********************************************************"  --  27
  ,"             |********************************************************"  --  28
  ,"             |********************************************************"  --  29
  ,"             |********************************************************"  --  30
  ,"             |********************************************************"  --  31
  ,"             |********************************************************"  --  32
  ,"             |********************************************************"  --  33
  ,"_____________|********************************************************"  --  34
  ,"**********************************************************************"  --  35
  ,"**********************************************************************"] --  36
--  1234567890123456789012345678901234567890123456789012345678901234567890
--           1         2         3         4         5         6         7

frontWall 1 0 = fromTexts '*'
  ["**********************************************************************"  --  1
  ,"**********************************************************************"  --  2
  ,"**********************************************************************"  --  3
  ,"**********************************************************************"  --  4
  ,"**********************************************************************"  --  5
  ,"**********************************************************************"  --  6
  ,"**********************************************************************"  --  7
  ,"**********************************************************************"  --  8
  ,"**********************************************************************"  --  9
  ,"**********************************************************************"  --  10
  ,"**********************************************************************"  --  11
  ,"**********************************************************************"  --  12
  ,"**********************___________________________*********************"  --  13
  ,"**********************|                         |*********************"  --  14
  ,"**********************|                         |*********************"  --  15
  ,"**********************|                         |*********************"  --  16
  ,"**********************|                         |*********************"  --  17
  ,"**********************|                         |*********************"  --  18
  ,"**********************|                         |*********************"  --  19
  ,"**********************|                         |*********************"  --  20
  ,"**********************|                         |*********************"  --  21
  ,"**********************|                         |*********************"  --  22
  ,"**********************|                         |*********************"  --  23
  ,"**********************|                         |*********************"  --  24
  ,"**********************|                         |*********************"  --  25
  ,"**********************|                         |*********************"  --  26
  ,"**********************|                         |*********************"  --  27
  ,"**********************|                         |*********************"  --  28
  ,"**********************|_________________________|*********************"  --  29
  ,"**********************************************************************"  --  30
  ,"**********************************************************************"  --  31
  ,"**********************************************************************"  --  32
  ,"**********************************************************************"  --  33
  ,"**********************************************************************"  --  34
  ,"**********************************************************************"  --  35
  ,"**********************************************************************"] --  36
frontWall 1   1  = reverseH 36 $ frontWall 1 (-1)
frontWall 1 (-1) = fromTexts '*'
  ["**********************************************************************"  --  1
  ,"**********************************************************************"  --  2
  ,"**********************************************************************"  --  3
  ,"**********************************************************************"  --  4
  ,"**********************************************************************"  --  5
  ,"**********************************************************************"  --  6
  ,"**********************************************************************"  --  7
  ,"**********************************************************************"  --  8
  ,"**********************************************************************"  --  9
  ,"**********************************************************************"  --  10
  ,"**********************************************************************"  --  11
  ,"**********************************************************************"  --  12
  ,"_______________________***********************************************"  --  13
  ,"                      |***********************************************"  --  14
  ,"                      |***********************************************"  --  15
  ,"                      |***********************************************"  --  16
  ,"                      |***********************************************"  --  17
  ,"                      |***********************************************"  --  18
  ,"                      |***********************************************"  --  19
  ,"                      |***********************************************"  --  20
  ,"                      |***********************************************"  --  21
  ,"                      |***********************************************"  --  22
  ,"                      |***********************************************"  --  23
  ,"                      |***********************************************"  --  24
  ,"                      |***********************************************"  --  25
  ,"                      |***********************************************"  --  26
  ,"                      |***********************************************"  --  27
  ,"                      |***********************************************"  --  28
  ,"______________________|***********************************************"  --  29
  ,"**********************************************************************"  --  30
  ,"**********************************************************************"  --  31
  ,"**********************************************************************"  --  32
  ,"**********************************************************************"  --  33
  ,"**********************************************************************"  --  34
  ,"**********************************************************************"  --  35
  ,"**********************************************************************"] --  36

-- ========================================================================
--
sideWall _   0  = mempty
sideWall 0   1  = reverseH 36 . replace (Draw '\\') (Draw '/') $ sideWall 0 (-1)
sideWall 0 (-1) = fromTexts '*'
  ["          \\***********************************************************"  --  1
  ,"           \\**********************************************************"  --  2
  ,"            \\*********************************************************"  --  3
  ,"             \\********************************************************"  --  4
  ,"             |********************************************************"  --  5
  ,"             |********************************************************"  --  6
  ,"             |********************************************************"  --  7
  ,"             |********************************************************"  --  8
  ,"             |********************************************************"  --  9
  ,"             |********************************************************"  --  10
  ,"             |********************************************************"  --  11
  ,"             |********************************************************"  --  12
  ,"             |********************************************************"  --  13
  ,"             |********************************************************"  --  14
  ,"             |********************************************************"  --  15
  ,"             |********************************************************"  --  16
  ,"             |********************************************************"  --  17
  ,"             |********************************************************"  --  18
  ,"             |********************************************************"  --  19
  ,"             |********************************************************"  --  20
  ,"             |********************************************************"  --  21
  ,"             |********************************************************"  --  22
  ,"             |********************************************************"  --  23
  ,"             |********************************************************"  --  24
  ,"             |********************************************************"  --  25
  ,"             |********************************************************"  --  26
  ,"             |********************************************************"  --  27
  ,"             |********************************************************"  --  28
  ,"             |********************************************************"  --  29
  ,"             |********************************************************"  --  30
  ,"             |********************************************************"  --  31
  ,"             |********************************************************"  --  32
  ,"             |********************************************************"  --  33
  ,"             |*******************************************************"  --  34
  ,"           ／*********************************************************"  --  35
  ,"         ／***********************************************************"] --  36
sideWall 1   1  = reverseH 36 . replace (Draw '\\') (Draw '/') $ sideWall 1 (-1)
sideWall 1 (-1) = fromTexts '*'
  ["**********************************************************************"  --  1
  ,"**********************************************************************"  --  2
  ,"**********************************************************************"  --  3
  ,"*************\\********************************************************"  --  4
  ,"*************|\\*******************************************************"  --  5
  ,"*************| \\******************************************************"  --  6
  ,"*************|  \\*****************************************************"  --  7
  ,"*************|   \\****************************************************"  --  8
  ,"*************|    \\***************************************************"  --  9
  ,"*************|     \\**************************************************"  --  10
  ,"*************|      \\*************************************************"  --  11
  ,"*************|       \\************************************************"  --  12
  ,"*************|        \\***********************************************"  --  13
  ,"*************|        |***********************************************"  --  14
  ,"*************|        |***********************************************"  --  15
  ,"*************|        |***********************************************"  --  16
  ,"*************|        |***********************************************"  --  17
  ,"*************|        |***********************************************"  --  18
  ,"*************|        |***********************************************"  --  19
  ,"*************|        |***********************************************"  --  20
  ,"*************|        |***********************************************"  --  21
  ,"*************|        |***********************************************"  --  22
  ,"*************|        |***********************************************"  --  23
  ,"*************|        |***********************************************"  --  24
  ,"*************|        |***********************************************"  --  25
  ,"*************|        |***********************************************"  --  26
  ,"*************|        |***********************************************"  --  27
  ,"*************|        |***********************************************"  --  28
  ,"*************|        |***********************************************"  --  29
  ,"*************|       ／***********************************************"  --  30
  ,"*************|     ／*************************************************"  --  31
  ,"*************|   ／***************************************************"  --  32
  ,"*************| ／*****************************************************"  --  33
  ,"*************／*******************************************************"  --  34
  ,"**********************************************************************"  --  35
  ,"*********************************************************************"] --  36
--  1234567890123456789012345678901234567890123456789012345678901234567890
--           1         2         3         4         5         6         7

{-
frontWall 0 0 = fromTexts '*'
  ["          \                                                           "  --  1
  ,"           \                                                          "  --  2
  ,"            \                                                         "  --  3
  ,"             \                                           _____________"  --  4
  ,"             |\                                         /|            "  --  5
  ,"             | \                                       / |            "  --  6
  ,"             |  \                                     /  |            "  --  7
  ," ＼          |   \                                   /   |            "  --  8
  ,"   ＼        |    \                                 /    |            "  --  9
  ,"     ＼      |     \                               /     |            "  --  10
  ,"       ＼    |      \                             /      |            "  --  11
  ,"         ＼  |       \                           /       |            "  --  12
  ,"           | |        \                         /        |            "  --  13
  ,"           | |        |\                        |        |            "  --  14
  ,"           | | |＼    | \                       |        |            "  --  15
  ,"           | | |  ＼  |  \                      |        |            "  --  16
  ,"           | | |    | |   \                     |        |            "  --  17
  ,"           | | |    | |    \                ____|        |            "  --  18
  ,"           | | |    | ||＼ |\             /|    |        |            "  --  19
  ,"           | | |    | ||  || \           / |    |        |            "  --  20
  ,"           | | |    | ||  ||  \         /  |    |        |            "  --  21
  ,"           | | |    | ||  ||＼|\       /|  |    |        |            "  --  22
  ,"           | | |    | ||  ||||| \     / |  |    |        |            "  --  23
  ,"           | | |    | ||  ||||| |     | |  |    |        |            "  --  24
  ,"           | | |    | ||  |||||／     ＼|  |    |        |            "  --  25
  ,"           | | |    | ||  |||／         ＼ |    |        |            "  --  26
  ,"           | | |    | ||  |／             ＼____|        |            "  --  27
  ,"           | | |    | || ／                     |        |            "  --  28
  ,"           | | |    | |／                       |        |            "  --  29
  ,"           | | |    |／                         ＼       |            "  --  30
  ,"           | | |   ／                             ＼     |            "  --  31
  ,"           | | | ／                                 ＼   |            "  --  32
  ,"           | | ／                                     ＼ |            "  --  33
  ,"           | ／                                         ＼____________"  --  34
  ,"           ／                                                         "  --  35
  ,"         ／                                                           "] --  36
--  1234567890123456789012345678901234567890123456789012345678901234567890
--           1         2         3         4         5         6         7
-}
